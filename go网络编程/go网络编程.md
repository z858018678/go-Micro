# go网络编程

## 运维指令

### nload

- 看网卡的实时的流量

### tcpflow

- 抓TCP包

### ss

### netstat

- nestat -s 可以看重穿，就可以知道网络情况

### nmon

- 关注,context,上下文切换
- 中断数
- 场景1、在做数据压测的时候发现数据传输的CUP消耗很高，利用nmon去观察中断数和上下文切换，可以发送的消息比较小，没有批量打包发

### top

### 指令图

## 网络通讯协议

### 

### socket

- 接口抽象层
- 概念

	- 应用程序通常通过“套接字”向网络发出请求或者应答网络请求。

- 主要操作：

	- 建立、接受连接
	- 读写、关闭、超时
	- 获取地址、端口

### tcp

- 服务端程序

	- 监听端口
	- 接收客户端请求建立连接
	- 创建 goroutine 处理连接

- 客户端程序

	- 建立与服务端的连接
	- 进行数据收发
	- 关闭连接

### udp

- 简单的传输层协议

	- 不需要建立连接
	- 不可靠的、没有时序的通信
	- 数据报是有长度（65535-20=65515）
	- 支持多播和广播
	- 低延迟，实时性比较好
	- 应用于用于视频直播、游戏同步

### http1.1/http2.2/quic(http3.0)

- 超文本传输协议
- 区别，HTTP2可以复用连接

### http2

- 二进制分帧，按帧方式传输
- 多路复用，代替原来的序列和阻塞机制
- 头部压缩，通过 HPACK 压缩格式

	- 穿过一次没变化不需要穿

- 服务器推送，服务端可以主动推送资源

### http3

- 连接建立延时低，一次往返可建立HTTPS连接
- 改进的拥塞控制，高效的重传确认机制
- 切换网络保持连接，从4G切换到WIFI不用重建连接

## 特点

### 1、网络编程很简单，质量比较高，不易出错

### 编程模型简单，可以讲复杂的编程网络实现的很简单

### 2、性能较差

## 网络编程基础

### io模型

- 
- Blocking IO - 阻塞I O
- Nonblocking IO - 非阻塞IO
- IO multiplexing - IO 多路复用
- Signal-driven IO - 信号驱动式IO（异步阻塞）
- Asynchronous IO - 异步IO
- 概念

	- 同步：调用端会一直等待服务端响应，直到返回结果
	- 异步：调用端发起调用之后不会立刻返回，不会等待服务端响应
	- 阻塞：服务端返回结果之前，客户端线程会被挂起，此时线程不可被 CPU 调度，线程暂停运行
	- 非阻塞：在服务端返回前，函数不会阻塞调用端线程，而会立刻返回

## giom

### tcp长连接

- Comet

	-     长连接管理层，主要是监控外网 TCP/Websocket端口，并且通过设备 ID 进行绑定 Channel 实现，以及实现了 Room 合适直播等大房间消息广播。

- Logic

	-     逻辑层，监控连接 Connect、Disconnect 事件，可自定义鉴权，进行记录 Session 信息（设备 ID、ServerID、用户 ID），业务可通过设备 ID、用户 ID、RoomID、全局广播进行消息推送。

- Job

	-     通过消息队列的进行推送消峰处理，并把消息推送到对应 Comet 节点。

